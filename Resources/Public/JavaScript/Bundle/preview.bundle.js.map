{"version":3,"file":"preview.bundle.js","sources":["../Core/preview.js"],"sourcesContent":["// GSAP Animation Preview\ndocument.addEventListener('DOMContentLoaded', () => {\n  setTimeout(() => {\n    const previewElement = document.querySelector('.ce-preview');\n    const animationSelectField = document.querySelector('[name*=\"[tx_content_gsap_animation_animation]\"]');\n    const durationInputField = document.querySelector('[data-formengine-input-name*=\"[tx_content_gsap_animation_duration]\"]');\n    const durationValueInputField = document.querySelector('[name*=\"[tx_content_gsap_animation_duration]\"]');\n    const easingField = document.querySelector('[name*=\"[tx_content_gsap_animation_easing]\"]');\n    const delayField = document.querySelector('[name*=\"[tx_content_gsap_animation_delay]\"]');\n\n    const gsap = window.gsap;\n    const AnimationDefinitions = window.AnimationDefinitions;\n\n    if (!gsap) {\n      console.error('GSAP not loaded. Please add GSAP library.');\n      return;\n    }\n    if (!AnimationDefinitions) {\n      console.error('AnimationDefinitions not loaded. Please ensure animation-definitions.js is loaded before this script.');\n      return;\n    }\n\n    let defaultPreviewDuration = 800; // in ms\n    const pauseBetweenLoops = 1000; // in ms, this was defaultPreviewDelay\n    let animationInterval = null;\n\n    function playGSAPPreview() {\n      if (!previewElement || typeof gsap === 'undefined' || !AnimationDefinitions) return;\n\n      const animType = animationSelectField?.value || 'default';\n      const animDef = AnimationDefinitions[animType] || AnimationDefinitions['default'];\n\n      if (!animDef) {\n        console.error(`Animation definition for \"${animType}\" not found.`);\n        return;\n      }\n\n      // Kill any existing tweens on the element to prevent conflicts\n      gsap.killTweensOf(previewElement);\n\n      const currentDurationSec = defaultPreviewDuration / 1000;\n      const currentDelaySec = delayField && delayField.value ? parseFloat(delayField.value) / 1000 : 0;\n      const currentEasing = easingField && easingField.value ? easingField.value : 'power2.out';\n\n      gsap.fromTo(previewElement,\n        { ...animDef.from },\n        {\n          ...animDef.to,\n          duration: currentDurationSec,\n          delay: currentDelaySec,\n          ease: currentEasing,\n          clearProps: \"all\", // Clears all inline styles set by GSAP upon completion or overwrite\n          onStart: () => {\n            // Ensure the element is visible at the start of the animation if opacity is involved\n            if (animDef.from.hasOwnProperty('opacity')) {\n               gsap.set(previewElement, {opacity: animDef.from.opacity});\n            } else if (animDef.to.hasOwnProperty('opacity') && animDef.to.opacity > 0) {\n               // If only 'to' has opacity and it's > 0, ensure it's initially visible if from doesn't specify\n               gsap.set(previewElement, {opacity: 0}); // Default to 0 if not specified in from\n            }\n          },\n          onComplete: () => {\n            setTimeout(() => {\n              // Simple fade out after the main animation completes and pause\n              gsap.to(previewElement, { opacity: 0, duration: 0.3 });\n            }, pauseBetweenLoops);\n          }\n        }\n      );\n    }\n\n    function startPreviewLoop() {\n      if (animationInterval) clearInterval(animationInterval);\n      playGSAPPreview(); // Play immediately\n      // Calculate total cycle time: animation duration + delay + pause + fadeout time\n      const totalCycleTime = (defaultPreviewDuration) +\n                             (delayField && delayField.value ? parseFloat(delayField.value) : 0) +\n                             pauseBetweenLoops + 300; // 300ms for the fade-out\n      animationInterval = setInterval(playGSAPPreview, totalCycleTime);\n    }\n\n    function handleParameterChange() {\n      // This function will be called by animation, duration, easing, or delay changes\n      console.log('Animation parameters changed, restarting preview loop.');\n      if (durationValueInputField) { // Update duration from the correct field\n          defaultPreviewDuration = Number.parseInt(durationValueInputField.value) || 800;\n      }\n      startPreviewLoop();\n    }\n\n    function initialize() {\n      console.log('GSAP Preview initialize');\n      if (previewElement) {\n        previewElement.classList.add('gsap-preview');\n      }\n\n      if (animationSelectField) {\n        animationSelectField.addEventListener('change', handleParameterChange);\n      }\n      if (durationInputField) { // This is the slider\n        durationInputField.addEventListener('change', (event) => {\n            // Update the visible number input when slider changes\n            if(durationValueInputField) durationValueInputField.value = event.target.value;\n            handleParameterChange();\n        });\n      }\n       if (durationValueInputField) { // This is the number input\n           defaultPreviewDuration = Number.parseInt(durationValueInputField.value) || 800;\n           // Also listen for direct changes to the number input if any\n           durationValueInputField.addEventListener('change', (event) => {\n               defaultPreviewDuration = Number.parseInt(event.target.value) || 800;\n               // Optional: update slider if it exists and is separate\n               if(durationInputField && durationInputField !== event.target) durationInputField.value = event.target.value;\n               handleParameterChange();\n           });\n       }\n\n\n      if (easingField) {\n        easingField.addEventListener('change', handleParameterChange);\n      }\n      if (delayField) {\n        delayField.addEventListener('change', handleParameterChange);\n      }\n\n      // Initial call to setup and start the animation loop\n      if (previewElement) {\n        startPreviewLoop();\n      }\n    }\n\n    initialize();\n  }, 100); // Short delay for initialization\n});\n"],"names":[],"mappings":"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"}